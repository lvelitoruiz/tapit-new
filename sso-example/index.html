<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Login Example</title>
  <meta content="width=device-width,initial-scale=1" name="viewport">

  <link rel="stylesheet" href="https://dev.tapit.com.co/assets/styles/tailwind.css">
  <script src="https://www.gstatic.com/firebasejs/7.15.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.15.4/firebase-auth.js"></script>
  <script>
    function showLoginPopup() {
      document.getElementById('loginPopup').classList.remove('hidden');
      document.getElementById('loginButton').classList.add('hidden');
    }

    const TAPIT_ORIGIN = 'https://localhost:4200';

    window.addEventListener("message", function (event) {
      if (event.data && event.data.channel === 'TAPIT') {
        performAction(event.data.action, event.data.data)
      }
    }, false);

    function performAction(action, data) {
      switch (action) {
        case 'setLoggedUser':
          if (data) {
            document.getElementById('loggedUser').innerText = JSON.stringify(data);
            document.getElementById('loginPopup').remove();
          }

          break;
      }
    }

    function setUpLogin() {

      const tapitIframe = document.getElementById('tapitIframe');

      /****************************************************************************************
       
        The following configuration shows the parameters with which 
        the application can be customized as follows:

        * If a parameter is not sent, the default value of the parameter will be taken.
        * If a parameter is sent with a custom value, it will be overwritten over the default value.
        * If a parameter with an empty value is sent, the value will be overwritten by removing 
          the default values in case no value is to be displayed.

      ************************************************************************/

      tapitIframe.contentWindow.postMessage({
        channel: 'TAPIT',
        action: 'config',
        config: {
          project: 'aguilapenalties', // String type parameter to indicate the source platform that is making the request
          logoUrl: '', // String type parameter for the image URL or the base64 logo image.
          sloganHtml: '', // String type parameter for the slogan in HTML tag format. Example: <p>Our Slogan</p>.
          showLoginFacebookButton: true, // Boolean type parameter to show the login and registration button with facebook.
          showOffersOption: false, // Boolean type parameter to show offers options.
          email: 'test@test.com', // String type parameter for user mail.
          emailHint: 'test@test.com',  // String type parameter for user email hint.
          passwordHint: '', // String type parameter for user password hint.
          signUpLegalHtml: '', // String type parameter for legend of acceptance of terms and conditions when the user registers, in HTML tag format. Example: <h1>By registering you accept our terms and conditions</h1>.
          loginLegalHtml: '', // String type parameter for legend of acceptance of terms and conditions when the user registers, in HTML tag format. Example: <p>By logging you accept our terms and conditions</p>.
          showCloseButton: true,  // Boolean type parameter to show the close button.
          styles: '', // String type parameter to add custom stylest in CSS format. Example: .app-button { border-radius: 3rem;}.
        }
      }, TAPIT_ORIGIN)

      tapitIframe.contentWindow.postMessage({
        channel: 'TAPIT',
        action: 'getUserCustomToken',
      }, TAPIT_ORIGIN)
    }

    function signInWithCustomToken(customToken) {
      firebase.auth().signInWithCustomToken(customToken)
        .then(function (userCredential) {
          document.getElementById('userData').innerText = 'Logged user ' + userCredential.email;
        })
        .catch(function (error) {

          console.error(error);
        });
    }

    var firebaseConfig = {
      apiKey: "AIzaSyBbMDkDVAUJ8MWcKMVtU7Onrzv5JVlfSbA",
      authDomain: "re-imagining-loyalty-dev.firebaseapp.com",
      databaseURL: "https://re-imagining-loyalty-dev.firebaseio.com",
      projectId: "re-imagining-loyalty-dev",
      storageBucket: "re-imagining-loyalty-dev.appspot.com",
      messagingSenderId: "25832745393",
      appId: "1:25832745393:web:d91879ef2d1bf959fcf590",
      measurementId: "G-JMD5T81SQM"
    };

    firebase.initializeApp(firebaseConfig);

    firebase.auth().onAuthStateChanged(function (userCredential) {
      if (userCredential) {
        document.getElementById('loggedUser').innerText = 'LOGGED_USER: ' + userCredential.email;
      }
    });
  </script>
</head>
<body>

<div id="loginPopup" class="hidden mx-auto max-w-md">
  <div class="fixed bottom-0 inset-x-0 px-4 pb-4 sm:inset-0 sm:flex sm:items-center sm:justify-center">
    <div class="fixed inset-0 transition-opacity">
      <div class="absolute inset-0 bg-neutral-500 opacity-75"></div>
    </div>
    <div class="bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:max-w-lg sm:w-full"
         role="dialog" aria-modal="true" aria-labelledby="modal-headline">
      <div class="bg-white">
        <iframe id="tapitIframe" onload="setUpLogin()" src="http://localhost:4200/sso/login"
                style="width: 100%; height: 836px"></iframe>
      </div>
    </div>
  </div>
</div>

<div class="text-center mt-20" id="loginButton">
  <button class="app-button bg-primary-500 text-white" onclick="showLoginPopup()">INICIA SESIÃ“N</button>
</div>

<div class="m-4 rounded-lg bg-neutral-200 p-4">
  <p id="loggedUser" class=" overflow-x-auto"></p>
</div>

</body>
</html>
